{"componentChunkName":"component---src-templates-post-post-jsx","path":"/blog/20170421","result":{"data":{"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd4TKJD/xAAVEAEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABBQJrf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABcQAAMBAAAAAAAAAAAAAAAAAAAQQQH/2gAIAQEAAT8hhytP/9oADAMBAAIAAwAAABAAz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAQUAAAAAAAAAAAAAAAEAETEQIVFxkf/aAAgBAQABPxBpQBvlqCpg90z7yisRbz//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"eventlog\"\n        title=\"eventlog\"\n        src=\"/tiffany-gatsby-blog/static/b68ce8f78e65bae82b56232a863fe314/ec2bf/eventlog.jpg\"\n        srcset=\"/tiffany-gatsby-blog/static/b68ce8f78e65bae82b56232a863fe314/9a1e7/eventlog.jpg 250w,\n/tiffany-gatsby-blog/static/b68ce8f78e65bae82b56232a863fe314/10bbb/eventlog.jpg 500w,\n/tiffany-gatsby-blog/static/b68ce8f78e65bae82b56232a863fe314/ec2bf/eventlog.jpg 768w\"\n        sizes=\"(max-width: 768px) 100vw, 768px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>公司已離職的傳說級神人大大留下來的事件檢視器因為公司資安問題而大調權限後掛了，因此我被指派想辦法生一個新的事件檢視器。<br>\n這邊為了可以掛內部系統目錄就把它砍掉重練成 Webform 了 (人家是用 Angular MVC 不然我也想跟著潮潮看的說 XD<br>\n原本調權限前我就修了一個執行檔讓它每天把當日的 Eventlog 記到資料庫 table 裡，這樣查歷史資料可以快很多，但調權限前完成沒多久後也用不到了。(泣</p>\n<p>以下是其中 C# 撈事件檢視器資料的 Code</p>\n<deckgo-highlight-code csharp  terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  highlight-lines=\"\">\n          <code slot=\"code\">// 取得主機列表\nList &lt;Machine&gt; machines = db.Machine.Where(x =&gt; x.Web_Type == web.Web_Type).ToList();\n\nParallel.ForEach(machines, machine =&gt; {\n\n    ManagementScope scope = new ManagementScope(&quot;\\\\\\\\&quot; + machine.Machine_Name + &quot;\\\\root\\\\cimv2&quot;);\n    scope.Connect();\n\n    string startTime = ManagementDateTimeConverter.ToDmtfDateTime(DateTime.Parse(web.Last_Update_Date.ToString(&quot;yyyy/MM/dd 00:00:00&quot;)));\n    string endTime = ManagementDateTimeConverter.ToDmtfDateTime(DateTime.Parse(DateTime.Now.Date.ToString(&quot;yyyy/MM/dd 00:00:00&quot;)));\n\n    string query = &quot;SELECT * FROM Win32_NTLogEvent WHERE (Logfile = &#39;電子商務&#39; OR Logfile = &#39;Application&#39;) AND TimeWritten &gt;= &#39;&quot; + startTime + &quot;&#39; AND TimeWritten &lt;= &#39;&quot; + endTime + &quot;&#39;&quot;;\n\n    WqlObjectQuery wqlQuery = new WqlObjectQuery(query);\n    ManagementObjectSearcher searcher = new ManagementObjectSearcher(scope, wqlQuery);\n    ManagementOperationObserver observer = new ManagementOperationObserver();\n\n    bool isComplete = false;\n\n    observer.ObjectReady += new ObjectReadyEventHandler((sender, args) =&gt; {\n        ManagementObject newObject = (ManagementObject) args.NewObject;\n\n        EventLog eventLog = new EventLog {\n            Web_Type = web.Web_Type,\n                Machine_Name = machine.Machine_Name,\n                Event_Time = ManagementDateTimeConverter.ToDateTime(newObject[&quot;TimeWritten&quot;].ToString()),\n                Event_Category = newObject[&quot;Category&quot;] == null ? 0 : int.Parse(newObject[&quot;Category&quot;].ToString()),\n                Event_Code = newObject[&quot;EventCode&quot;] == null ? 0 : int.Parse(newObject[&quot;EventCode&quot;].ToString()),\n                Log_File = newObject[&quot;Logfile&quot;] == null ? &quot;&quot; : newObject[&quot;Logfile&quot;].ToString().Trim(),\n                Record_No = newObject[&quot;RecordNumber&quot;] == null ? 0 : int.Parse(newObject[&quot;RecordNumber&quot;].ToString()),\n                Source_Name = newObject[&quot;SourceName&quot;] == null ? &quot;&quot; : newObject[&quot;SourceName&quot;].ToString().Trim(),\n                Event_Type = newObject[&quot;Type&quot;] == null ? &quot;&quot; : newObject[&quot;Type&quot;].ToString().Trim(),\n                Event_Message = newObject[&quot;Message&quot;] == null ? &quot;&quot; : newObject[&quot;Message&quot;].ToString().Trim(),\n                Event_Project = GetProjectName(newObject[&quot;Message&quot;] == null ? &quot;&quot; : newObject[&quot;Message&quot;].ToString().Trim()),\n                Message_Category = GetMessageCategory(newObject[&quot;Message&quot;] == null ? &quot;&quot; : newObject[&quot;Message&quot;].ToString().Trim())\n        };\n\n        eventLogList.Add(eventLog);\n    });\n\n    observer.Completed += new CompletedEventHandler((sender, args) =&gt; {\n        isComplete = true;\n    });\n\n    searcher.Get(observer);\n\n    while (!isComplete) {\n        System.Threading.Thread.Sleep(1000);\n    }\n\n});</code>\n        </deckgo-highlight-code>","timeToRead":2,"frontmatter":{"title":"存取遠端 EventLog","date":"21 Apr 2017","tags":["asp.net","javascript"],"path":"blog/20170421","excerpt":"在公司中實作一個 Event log 的查詢工具。（之後來寫了 D3 呈現查詢異常查詢的部分）"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"path":"blog/20210725-2","title":"SVGR 設置","tags":["javascript"],"excerpt":"webpack loader 以 Component 方式使用 Svg。"}}},{"node":{"frontmatter":{"path":"blog/20210725","title":"初試 SonarQube","tags":["tool"],"excerpt":"記錄下認識的新東西。"}}},{"node":{"frontmatter":{"path":"blog/20210110","title":"Pop Quiz","tags":["javascript"],"excerpt":"記錄踩到的陷阱題。"}}},{"node":{"frontmatter":{"path":"blog/20210109-2","title":"IntersectionObserver","tags":["javascript"],"excerpt":"公司專案有個日期連動的 scroll 優化試驗，原先是監聽 scroll。"}}},{"node":{"frontmatter":{"path":"blog/20210109","title":"Response Set-Cookie 無效","tags":["apollo"],"excerpt":"記錄個之前在和同事們弄 Side project 時犯蠢遇到的問題與解決方式。"}}},{"node":{"frontmatter":{"path":"blog/20200910","title":"Apollo Server 入門篇","tags":["apollo"],"excerpt":"快速複習去年分享的 GraphQL Schema 和 Client query 語法，並簡介如何以 Apollo Server 建立 GraphQL Server。"}}},{"node":{"frontmatter":{"path":"blog/20190909","title":"Prisma - Schema, Data Model, Relations, Client","tags":["prisma"],"excerpt":"未來 Side project 可能會應用到的 SDL first 開發流程角度，簡介此可以取代傳統 ORM 的 DB toolkit。"}}},{"node":{"frontmatter":{"path":"blog/20210109-3","title":"REST / RESTful & HTTP Methods","tags":["javascript"],"excerpt":"簡易整理。"}}},{"node":{"frontmatter":{"path":"blog/20200527","title":"常用 NoSQL 雲端資料庫 - Part 2 Firebase","tags":["firebase"],"excerpt":"簡介 Google 提供的後端服務平臺（BaaS）中的兩種 DB，realtime database 和 cloud firestore。"}}},{"node":{"frontmatter":{"path":"blog/20200630","title":"Express - Authentication, Authorization and Security","tags":["security","express"],"excerpt":"簡介 Express RESTful API Server 範例中 JWT 權限、授權相關。"}}},{"node":{"frontmatter":{"path":"blog/20200518","title":"常用 NoSQL 雲端資料庫 - Part 1 MongoDB","tags":["mongodb"],"excerpt":"簡介 Relational/NoSQL database、mongoose ORM 寫 mongo CRUD API。"}}},{"node":{"frontmatter":{"path":"blog/20191125","title":"初探 RxJS（下）","tags":["rxjs"],"excerpt":"簡介上次未完的 RxJS 剩餘角色，和介紹目前公司後台專案使用的 redux-observable。"}}},{"node":{"frontmatter":{"path":"blog/20191107","title":"Javascript Event loop - macro task & micro task","tags":["javascript"],"excerpt":"介紹 Event loop 容易混淆的異步任務 macro task & micro task。"}}},{"node":{"frontmatter":{"path":"blog/20190907","title":"GraphQL & Apollo Client","tags":["apollo"],"excerpt":"簡單介紹 React Client 端如何用 Apollo 對 GraphQL Server 做資料存取操作。"}}},{"node":{"frontmatter":{"path":"blog/20191017","title":"初探 RxJS（上）","tags":["rxjs"],"excerpt":"簡介相關的設計模式中的 Behavioral Pattern，再介紹 RxJS（先講 Observable）"}}},{"node":{"frontmatter":{"path":"blog/20190906","title":"初探 Storybook","tags":["javascript"],"excerpt":"初探這款能夠在開發前端元件或是函式庫的同時，可以快速地建立元件各種操作模式或是樣式的工具。"}}},{"node":{"frontmatter":{"path":"blog/20190707","title":"JavaScript HTML5 Web Worker & CRA 使用踩雷","tags":["javascript"],"excerpt":"JavaScript 是單執行緒、單線程的程式語言，所有的程式碼片段都會在堆疊中被執行，Web worker 相當於可讓主線程開其他 thread。"}}},{"node":{"frontmatter":{"path":"blog/20190906-2","title":"React Hooks - useCallback, useMemo, useRef","tags":["reactjs"],"excerpt":"JavaScript 是單執行緒、單線程的程式語言，所有的程式碼片段都會在堆疊中被執行，Web worker 相當於可讓主線程開其他 thread。"}}},{"node":{"frontmatter":{"path":"blog/20190108","title":"JavaScript 認識非同步 Callback, Promise, async/await","tags":["javascript"],"excerpt":"Asynchronous 非同步的不同寫法的整理筆記。"}}},{"node":{"frontmatter":{"path":"blog/20180521","title":"Web 常見攻擊手法","tags":["security"],"excerpt":"擁有基本的資安觀念保護好自家資料和 user 使用環境是開發人員重要的一點。"}}},{"node":{"frontmatter":{"path":"blog/20180514","title":"JavaScript 中 this 指向","tags":["javascript"],"excerpt":"簡介 this 指向的六種情況。"}}},{"node":{"frontmatter":{"path":"blog/20170714","title":"WebForm 使用 reCAPTCHA 驗證","tags":["asp.net"],"excerpt":"這個我不是機器人驗證一定不陌生，滿多登入畫面會看到的，剛好今天接到把圖形驗證改為 reCAPTCHA 就順手記下。"}}},{"node":{"frontmatter":{"path":"blog/20170508","title":"WebForm 圖片上傳檢查","tags":["asp.net"],"excerpt":"開放上傳有可能被傳奇怪東西的風險，只檢查所看到的副檔名，謹慎來說似乎是不夠的。"}}},{"node":{"frontmatter":{"path":"blog/20170604","title":"Web App 推播通知","tags":["asp.net"],"excerpt":"隨著行動和穿載裝置的興起，推播通知 (Push Notification) 成為維繫App用戶關係相當有力的工具"}}},{"node":{"frontmatter":{"path":"blog/20170728","title":"WebForm 註冊 JavaScript","tags":["asp.net","javascript"],"excerpt":"動態產生JS在目前公司專案中是滿常用到的小技巧，不同的用法會產生在Web Page 的不同位置而有直譯式語言的前後順序差。"}}}]}},"pageContext":{"postPath":"blog/20170421","translations":[{"hreflang":"en","path":"/blog/20170421"}]}},"staticQueryHashes":["4097791827"]}