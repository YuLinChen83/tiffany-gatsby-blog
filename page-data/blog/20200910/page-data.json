{"componentChunkName":"component---src-templates-post-post-jsx","path":"/blog/20200910","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://hackmd.io/mOTKzMwoRyaDvP2NkyV6MQ?view\" target=\"_blank\" rel=\"nofollow\">HackMD</a></p>\n<h1>GraphQL Server</h1>\n<h2>å…ˆå‰é–‹ç™¼ Server çš„æ¼”è®Šæ¦‚è¦ï¼š<a href=\"https://github.com/prisma-labs/graphql-yoga\" target=\"_blank\" rel=\"nofollow\">GraphQL Yoga</a> ğŸ”œ <a href=\"https://www.apollographql.com/docs/apollo-server/\" target=\"_blank\" rel=\"nofollow\">Apollo Server</a></h2>\n<ul>\n<li>ç¤¾ç¾¤å¤§å°ã€æ´»èºåº¦ã€ä½¿ç”¨è€…å¤šå¯¡</li>\n<li>\n<p>è€ƒé‡æœªä¾†å¯èƒ½æœƒæœ‰ä½¿ç”¨ Federation çš„å ´æ™¯ <a href=\"https://chihching.net/intro-graphql-federation-zh-hant\" target=\"_blank\" rel=\"nofollow\">Federation å¯ä»¥åƒè€ƒé€™ç¯‡</a></p>\n<ul>\n<li>å¾Œç«¯æƒ³è¦ä¸åŒ microservice è™•ç†ä»–å€‘å„è‡ªçš„é‚è¼¯ï¼Œå„è‡ªç¶­è­·è² è²¬ç¯„åœçš„ Schema</li>\n</ul>\n</li>\n</ul>\n<h2>GraphQL Schema</h2>\n<p>å®šç¾© GraphQL API çš„è¼ªå»“åŠè¦ç¯„ï¼Œç•¶èˆ‡ Resolver è™•ç†å‡ºçš„è³‡æ–™ä¸ç¬¦åˆ Type å°±æœƒå™´éŒ¯ï¼ˆä½† Null å¯ä»¥é€šéï¼‰<br>\nå¿«é€Ÿè¤‡ç¿’å¸¸ç”¨çš„å®šç¾© Schema ç”¨æ³•ï¼š</p>\n<ul>\n<li>\n<p>Object type</p>\n<ul>\n<li>åŒ…å« fields å’Œ field çš„ type</li>\n</ul>\n<deckgo-highlight-code graphql  terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  highlight-lines=\"\">\n          <code slot=\"code\">#################### Type ###################\ntype User {\n  lastName: String\n  firstName: String\n  birthday: Date\n  createdAt: Date\n  updatedAt: Date\n}\n\n#################### Root ###################\ntype Query {\n  user(id: ID!): User\n}\n\ntype Mutation {\n  createUser(data: UserCreateInput!): User\n}</code>\n        </deckgo-highlight-code>\n<ul>\n<li>Queryã€Mutationã€Subscription ä¹Ÿæ˜¯ï¼Œä½†åŒæ™‚ä¹Ÿæ˜¯ Schema çš„ entry point</li>\n</ul>\n</li>\n<li>\n<p>Input Object Type\nè·Ÿ Object Type å¹¾ä¹ä¸€æ¨£çš„é‚„æœ‰ Input Object Typeï¼Œä½†æ˜¯ä¸€å€‹æ˜¯å‚³å…¥ Argument ä½œç‚º Inputï¼ˆåªæœƒåœ¨å·¦é‚Šï¼‰ ï¼Œä¸€å€‹æ˜¯ç”¨æ–¼è³‡æ–™ç´¢å–å±•ç¤º</p>\n<ul>\n<li>æ¨è–¦æ¯æ”¯ mutation éƒ½æ–°å¢ä¸€æ”¯å°ˆå±¬çš„ input object typeï¼Œç¿’æ…£å‘½å xxxInput</li>\n</ul>\n</li>\n<li>\n<p>Scalar Type (Int, Float, String, Boolean, ID, Enum)</p>\n<ul>\n<li>\n<p>Enum</p>\n<deckgo-highlight-code graphql  terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  highlight-lines=\"\">\n          <code slot=\"code\">enum Sort {\nasc\ndesc\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>å…¶ä»–ä¾‹å¦‚ Dateã€Timestamp éƒ½è¦å¦å¤–è‡ªå®šç¾©</li>\n</ul>\n</li>\n<li>\n<p>Non-null Syntax</p>\n<ul>\n<li>type å³é‚ŠåŠ ä¸Š <code>!</code> ä¿è­‰ä¸ç‚ºç©º</li>\n<li>ä¸€æ—¦ä¿®æ”¹ Not-Null field å°±æœƒæ˜¯ Breaking Changeï¼Œå»ºè­°å‰›é–‹å§‹è¨­è¨ˆæ™‚ï¼Œé™¤äº† ID ä»¥å¤–çš„æ¬„ä½éƒ½ä¸è¦åŠ ä¸Š</li>\n</ul>\n</li>\n<li>\n<p>Array Type Syntax</p>\n<ul>\n<li>ç”¨ <code>[]</code> åŒ…èµ·ä¾†å°±æ˜¯ array type</li>\n<li>ä¾‹å¦‚ï¼š<code>notIn: [Int]</code>ã€<code>teachers: [User]</code>ã€<code>courses: [Course]</code></li>\n<li>æœ‰ç„¡åŠ ä¸Š Non-null Syntax èˆ‰ä¾‹ï¼š</li>\n<li><code>teachers: [User]</code></li>\n<li><code>teachers: [User!]</code></li>\n<li><code>teachers: [User!]!</code></li>\n</ul>\n</li>\n<li>ä¸ç®¡æ˜¯ Object Type æˆ– Scalar Type éƒ½èƒ½ä½¿ç”¨ Argument</li>\n<li>\n<p>è¨»è§£ï¼š</p>\n<ul>\n<li>å–®è¡Œå‡ºç¾åœ¨æ–‡ä»¶ <code>\"</code></li>\n<li>å–®è¡Œä¸å‡ºç¾åœ¨æ–‡ä»¶ <code>#</code></li>\n<li>å¤šè¡Œå‡ºç¾åœ¨æ–‡ä»¶ <code>\"\"\"</code></li>\n</ul>\n</li>\n</ul>\n<h2>çµ„æˆ</h2>\n<h3>1. Create an instance of ApolloServer</h3>\n<ul>\n<li>\n<p><code>new ApolloServer({ typeDefs, resolvers }</code> æœ€åŸºæœ¬è¦å‚³ typeDefsã€ resolversï¼Œä½†æˆ‘å€‘é‚„éœ€è¦é€é context ä¾†æ”¾ prisma clientï¼š</p>\n<deckgo-highlight-code javascript  terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  highlight-lines=\"\">\n          <code slot=\"code\">// server.js\nconst { ApolloServer } = require(&#39;apollo-server&#39;);\nconst dotenv = require(&#39;dotenv/config&#39;);\nconst { createContext } = require(&#39;./context&#39;);\nconst { typeDefs } = require(&#39;./typeDefs&#39;);\nconst { resolvers } = require(&#39;./resolvers&#39;);\n\nconst server = new ApolloServer({ typeDefs, resolvers, context: createContext });\nserver.listen().then(({ url }) =&gt; {\nconsole.log(`ğŸš€  Server ready at ${url}`);\n});</code>\n        </deckgo-highlight-code>\n<ul>\n<li>èµ·èµ·ä¾†çš„é è¨­ port å°±æ˜¯ GraphQL Playgroundï¼Œå¯ä»¥åœ¨é€™é‚Šç¢ºèªæ–‡ä»¶ã€è©¦æ‰“ api ç¬¦ä¸ç¬¦åˆè‡ªå·±çš„é æœŸ</li>\n</ul>\n</li>\n<li>\n<p><code>context</code> ä¸»è¦éƒ½æ˜¯æ”¾ request/responseã€ORMã€è™•ç†èªè­‰ç­‰ç›¸é—œçš„æ±è¥¿ï¼Œå¾—ä»¥åœ¨æ¯å€‹ resolver ä½¿ç”¨ï¼ˆåˆæœ‰é»åƒ middlewareï¼‰</p>\n<deckgo-highlight-code javascript  terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  highlight-lines=\"\">\n          <code slot=\"code\">// context.js\nconst { PrismaClient } = require(&#39;@prisma/client&#39;);\nconst jwt = require(&#39;jsonwebtoken&#39;);\nconst prisma = new PrismaClient();\n\nconst parseCookie = (str = &#39;&#39;) =&gt;\nstr\n  ? str\n      .split(&#39;;&#39;)\n      .map((v) =&gt; v.split(&#39;=&#39;))\n      .reduce((acc, v) =&gt; {\n        acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());\n        return acc;\n      }, {})\n  : {};\n\nasync function createContext({ req, res }) {\nconst cookies = parseCookie(req.headers.cookie);\nconst { accessToken, refreshToken } = cookies;\nconst context = {\n  request: req,\n  response: res,\n  prisma,\n};\nlet decoded = await jwt.decode(accessToken, process.env.ACCESS_TOKEN_SECRET);\nif (!decoded) {\n  if (refreshToken) {\n    context.currentUser = decoded || null;\n  }\n}\nreturn context;\n}\n\nmodule.exports = {\ncreateContext,\n};</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p><code>typeDefs</code> å®šç¾© Schema (Query, Mutation, Type, Input object ...)</p>\n<ul>\n<li>Query, Mutation å…¶å¯¦å°±æ˜¯å®šç¾© field æˆ– function name è¢« call æ™‚çš„ ==input, output æ ¼å¼==ï¼Œæ ¼å¼å°±æ˜¯é è¨­çš„ scalar type æˆ–æ˜¯è‡ªå·±å®šç¾©çš„ type, input object, enum...ç­‰ç­‰ï¼ŒçœŸæ­£é‚è¼¯å¯¦ä½œåœ¨èˆ‡å…¶ name å°æ‡‰çš„ resolver</li>\n</ul>\n</li>\n<li><code>resolvers</code> ä¾æ“šå®šç¾©çš„ Query, Mutation Schema çš„è³‡æ–™æ“ä½œã€é‚è¼¯ç­‰å¯¦ä½œï¼ˆåç¨±è¦å°ä¸Šï¼‰</li>\n<li><a href=\"https://stackoverflow.com/a/60747952/7849574\" target=\"_blank\" rel=\"nofollow\">typeDefs, resolvers æ‹†åˆ†åƒè€ƒ</a>\ntypeDefs å¯ä»¥çµ¦é™£åˆ—\nresolvers å¯ä»¥åœ¨å¦å¤–è§£æ§‹åˆä½µæˆä¸€å¤§åŒ…</li>\n</ul>\n<h3>2. typeDefs</h3>\n<ul>\n<li>é€é <code>apollo-server</code> çš„ gql å¯« graph schemaï¼Œä¸€å€‹ typeDefs ç‰©ä»¶è£¡é€šå¸¸ä¸€å®šæœƒæœ‰ type Query å’Œ type Mutationï¼Œè£¡é¢å†å®šç¾©è¦ç¶“é resolver è™•ç†çš„ field æˆ– function çš„åç¨±ã€è¼¸å…¥å‹åˆ¥ã€è¼¸å‡ºå‹åˆ¥ï¼ˆè©³ç´°å¯«æ³•è«‹åƒé–± <a href=\"https://graphql.org/learn/\" target=\"_blank\" rel=\"nofollow\">GraphQL å®˜æ–¹æ–‡ä»¶</a>ï¼‰</li>\n<li>\n<p>åœ¨å®šç¾© type æ™‚ï¼Œfield name è¦å°ç…§ DB å¯¦éš›çš„ Table column name ï¼Œä¾æˆ‘å€‘ prisma æ˜ å°„ DB çš„å°ˆæ¡ˆå¯ä»¥ç›´æ¥åƒç…§æª”æ¡ˆ <code>schema.prisma</code>ï¼ˆæˆ‘å€‘ MySQL DB ä¸­çš„ Tables å°±æ˜¯ä¸‹ <code>npx prisma migrate save --experimental</code>ã€<code>npx prisma migrate up --experimental</code>ï¼Œç„¶å¾Œä¾æ“šé€™æª”æ¡ˆå»ºç«‹/ä¿®æ”¹çš„ï¼‰\nèˆ‰ä¾‹ï¼š</p>\n<ol>\n<li>schema.prisma æœ‰å®šç¾©ä¸€å€‹æœƒç”¢ç”Ÿ user table çš„ data model</li>\n</ol>\n<deckgo-highlight-code json  terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  highlight-lines=\"\">\n          <code slot=\"code\">      model User {\n  id             Int              @default(autoincrement()) @id\n  email          String           @unique\n  password       String\n  lastName       String           @map(name: &quot;last_name&quot;)\n  firstName      String           @map(name: &quot;first_name&quot;)\n  nickName       String           @map(name: &quot;nick_name&quot;)\n  birthday       DateTime?\n  headThumb      String?          @map(name: &quot;head_thumb&quot;)\n  desc           String?\n  notified       Boolean          @default(false)\n  activated      Boolean          @default(false)\n  facebookId     String?          @map(name: &quot;facebook_id&quot;)\n  googleId       String?          @map(name: &quot;google_id&quot;)\n  createdAt      DateTime         @map(name: &quot;created_at&quot;)  @default(now())\n  updatedAt      DateTime?        @map(name: &quot;updated_at&quot;)  @updatedAt\n  courses        Course[]\n\n  @@map(name: &quot;user&quot;)\n}</code>\n        </deckgo-highlight-code>\n<ol start=\"2\">\n<li>ç„¶å¾Œåœ¨ typeDefs å®šç¾©ä¸€å€‹ user çš„ crud è¼ªå»“ï¼Œä¾æ“šæœ‰ç„¡è³‡æ–™ç•°å‹•åˆ†åˆ° type Queryï¼ˆç„¡è³‡æ–™ç•°å‹•ï¼Œé€šå¸¸ camelCase åè©ï¼‰/ type Mutationï¼ˆæœ‰è³‡æ–™ç•°å‹•ï¼Œé€šå¸¸ camelCase å‹•è©+åè©ï¼‰åº•ä¸‹ã€‚å®£å‘Š Type é¡å‹çš„åç¨±ç¿’æ…£ PascalCase åè©ã€‚</li>\n<li>ç•¶è¦å‚³å¾ˆå¤šå€¼çš„è©±ï¼Œé€šå¸¸æœƒå®£å‘Šä¸€å€‹å‚³ input object type çš„åƒæ•¸ï¼ˆè² è²¬æ–°å¢çš„ input å‚³çš„åƒæ•¸æˆ‘å€‘çµ±ä¸€å« <code>data</code> å¥½äº†ï¼‰ï¼Œæœƒä¾æ“šä¸åŒæ“ä½œå®šç¾©ä¸åŒçš„ <code>input XxxxInput</code>ï¼Œç•¶ä¸­å­—æ®µå¯èƒ½å°±æœƒåŒ…å« Create/Update/Update...ã€‚ä¾‹å¦‚ï¼š<code>signUp(data: UserCreateInput!): User</code>\né€™äº›å‚³çš„åƒæ•¸å¾ˆå¤§åŒ…çš„è©±é€šå¸¸åœ¨ client query å°±æœƒå®£å‘Šè®Šæ•¸ã€input object å‚³çš„æ•´åŒ…å¦å¤–è¢«æ”¾åœ¨ Query Variablesï¼ˆplayground ç¯„ä¾‹ï¼‰</li>\n<li>\n<p>å¦å¤–æé†’é©ç•¶çš„è¨»è§£æœ‰åŠ©æ–¼æ›´å®Œæ•´ Schema åŠæ–‡ä»¶çš„èªªæ˜ï¼Œå¯ä»¥å¤šå¤šåˆ©ç”¨</p>\n<deckgo-highlight-code javascript  terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  highlight-lines=\"\">\n          <code slot=\"code\">        const { gql } = require(&#39;apollo-server&#39;);\nconst typeDefs = gql`\n##################### Common å…±ç”¨ ###################\nscalar DateTime\nscalar Date\n\n      enum Gender {\n        &quot;Male&quot;\n        M\n        &quot;Female&quot;\n        F\n        &quot;TRANSGENDER&quot;\n        T\n      }\n\n      enum Sort {\n        asc\n        desc\n      }\n\n      &quot;&quot;&quot;\n      å…±ç”¨è¡¨æ ¼filterä¿ç•™å­—åƒæ•¸\n      &quot;&quot;&quot;\n      input TableStringFilterInput {\n        ne: String\n        eq: String\n        le: String\n        lt: String\n        ge: String\n        gt: String\n        contains: String\n        notContains: String\n        between: [String]\n        beginsWith: String\n      }\n      input TableIntFilterInput {\n        equals: Int\n        not: Int\n        in: Int\n        notIn: [Int]\n        lt: Int\n        lte: Int\n        ge: Int\n        gte: Int\n      }\n\n      ##################### User ä½¿ç”¨è€… ###################\n      &quot;&quot;&quot;\n      å»ºç«‹ä½¿ç”¨è€…åƒæ•¸\n      &quot;&quot;&quot;\n      input UserCreateInput {\n        email: String!\n        password: String!\n        lastName: String!\n        firstName: String!\n        nickName: String!\n        birthday: DateTime!\n        headThumb: String\n        desc: String\n        notified: Boolean\n        activated: Boolean\n        facebookId: String\n        googleId: String\n        updatedAt: DateTime\n        courseIds: String\n      }\n\n      &quot;&quot;&quot;\n      å¯æ›´æ–°ä½¿ç”¨è€…åƒæ•¸\n      &quot;&quot;&quot;\n      input UserUpdateInput {\n        lastName: String\n        firstName: String\n        nickName: String\n        headThumb: String\n        desc: String\n        notified: Boolean\n        activated: Boolean\n        facebookId: String\n        googleId: String\n      }\n\n      &quot;&quot;&quot;\n      ä½¿ç”¨è€…æ¬„ä½\n      &quot;&quot;&quot;\n      type User {\n        id: ID\n        email: String\n        lastName: String\n        firstName: String\n        nickName: String\n        birthday: DateTime\n        headThumb: String\n        desc: String\n        notified: Boolean\n        activated: Boolean\n        facebookId: String\n        googleId: String\n        createdAt: DateTime\n        updatedAt: DateTime\n        courseIds: String\n      }\n\n      &quot;&quot;&quot;\n      ç¯©é¸Useråƒæ•¸\n      &quot;&quot;&quot;\n      input UserFilterKey {\n        email: TableStringFilterInput\n        lastName: TableStringFilterInput\n        firstName: TableStringFilterInput\n        nickName: TableStringFilterInput\n        gender: TableStringFilterInput\n      }\n\n      &quot;&quot;&quot;\n      æ’åºUseråƒæ•¸\n      &quot;&quot;&quot;\n      input UserOrderByInput {\n        email: Sort\n        firstName: Sort\n        birthday: Sort\n        createdAt: Sort\n        updatedAt: Sort\n      }\n\n      ##################### Root Object ###################\n\n      type Query {\n        currentUser: User\n        users(filter: UserFilterKey, skip: Int, take: Int, orderBy: UserOrderByInput): [User!]\n        signIn(email: String!, password: String!): User\n      }\n\n      type Mutation {\n        signUp(data: UserCreateInput!): User\n        updateUser(userId: Int!, data: UserUpdateInput!): User\n        deleteUser(userId: Int!): Boolean\n      }\n    `;\n\n    module.exports = {\n      typeDefs,\n    };\n    ```\n\né †ä¾¿çœ‹ä¸€ä¸‹åœ¨ playground æ‰“ signUp æ€éº¼æ“ä½œ\n![](https://i.imgur.com/PCt8w0Y.png)</code>\n        </deckgo-highlight-code>\n</li>\n</ol>\n</li>\n</ul>\n<h3>3. resolvers</h3>\n<ul>\n<li>ä¸Šæ¬¡ä¸»è¦æåˆ°çš„ï¼Œç›¸ç•¶æ–¼ GraphQL query handlerã€controller çš„æ¦‚å¿µï¼Œå®šç¾© GraphQL query response çš„ functions é›†åˆï¼Œé€™æ¯å€‹ function éƒ½æ˜¯ schema çš„ type æˆ– field çš„ resolver</li>\n<li>\n<p>çœ‹å€‹ç¯„ä¾‹</p>\n<deckgo-highlight-code javascript  terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  highlight-lines=\"\">\n          <code slot=\"code\">// resolvers.js\nconst path = require(&#39;path&#39;);\nconst { DateTimeResolver, DateResolver } = require(&#39;graphql-scalars&#39;);\nconst bcrypt = require(&#39;bcrypt&#39;);\nconst crypto = require(&#39;crypto&#39;);\nconst jwt = require(&#39;jsonwebtoken&#39;);\nconst { AuthenticationError, ForbiddenError, UserInputError } = require(&#39;apollo-server-core&#39;);\nconst { combineResolvers, skip } = require(&#39;graphql-resolvers&#39;);\n\nconst createTokens = (user) =&gt; {\nconst refreshToken = jwt.sign({ userId: user.id, count: user.count }, process.env.REFRESH_TOKEN_SECRET, {\n  expiresIn: &#39;7d&#39;,\n});\nconst accessToken = jwt.sign({ userId: user.id }, process.env.ACCESS_TOKEN_SECRET, {\n  expiresIn: &#39;15min&#39;,\n});\nreturn { refreshToken, accessToken };\n};\n\nconst isAuthenticated = async (parent, args, { prisma, currentUser, request }) =&gt; {\nif (currentUser) {\n  const user = await prisma.user.findOne({\n    where: {\n      id: Number(currentUser.userId),\n    },\n  });\n  if (user) {\n    return skip;\n  }\n}\nreturn new AuthenticationError(&#39;æœªèªè­‰ç„¡æ³•å­˜å–ï¼Œè«‹å…ˆç™»å…¥&#39;);\n};\n\nconst resolvers = {\nDateTime: DateTimeResolver,\nDate: DateResolver,\nQuery: {\n  currentUser: async (parent, args, { prisma, currentUser }) =&gt; {\n    if (!currentUser || !currentUser.userId) {\n      throw new AuthenticationError(&#39;ç•¶å‰æœªç™»å…¥ï¼è«‹é‡æ–°ç™»éŒ„&#39;);\n    }\n    return await prisma.user.findOne({ where: { id: currentUser.userId } });\n  },\n  users: combineResolvers(\n    isAuthenticated,\n    async (parent, { filter, skip, take, orderBy }, { prisma }) =&gt;\n      await prisma.user.findMany({ where: filter || {}, skip, take, orderBy })\n  ),\n  signIn: async (parent, { email, password }, { prisma, response, request }) =&gt; {\n    const user = await prisma.user.findOne({ where: { email } });\n    if (!user || !bcrypt.compareSync(password, user.password)) {\n      throw new AuthenticationError(&#39;ç™»å…¥å¤±æ•—ï¼šå¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤&#39;);\n    }\n    const { accessToken, refreshToken } = createTokens(user);\n    response.cookie(&#39;refreshToken&#39;, refreshToken, { httpOnly: true });\n    response.cookie(&#39;accessToken&#39;, accessToken, { httpOnly: true });\n    return user;\n  },\n},\nMutation: {\n  signUp: async (parent, { data }, { prisma }) =&gt; {\n    if (!!(await prisma.user.findOne({ where: { email: data.email } }))) {\n      throw new UserInputError(&#39;å·²è¨»å†Šï¼Œè«‹ç›´æ¥ç™»å…¥&#39;);\n    }\n    data.password = bcrypt.hashSync(data.password, 12);\n    return await prisma.user.create({\n      data,\n    });\n  },\n  updateUser: async (parent, { userId, data }, { prisma }) =&gt; {\n    return await prisma.user.update({\n      where: { id: userId },\n      data,\n    });\n  },\n  deleteUser: async (parent, { userId }, { prisma }, info) =&gt; {\n    await prisma.user.delete({ where: { id: userId } });\n    return true;\n  },\n},\n};\n\nmodule.exports = {\nresolvers,\n};</code>\n        </deckgo-highlight-code>\n</li>\n<li>ä¹‹å¾Œæƒ³è¦åšèº«ä»½èªè­‰çš„è©±ï¼Œå¯ä»¥ä½¿ç”¨ <code>graphql-resolvers</code>ï¼Œç”¨ combineResolvers æŠŠå¤šå€‹ resolver åŒ…èµ·ï¼ˆæ‡‰è©²æ˜¯ç¨® Higher order functions?ï¼‰æœƒç”±å·¦è‡³å³é †åºåŸ·è¡Œ(å‰é¢ resolver è¦ return skipï¼Œæœ€å¾Œä¸€å€‹ä»è¦å›å‚³ Schema å®šç¾©çš„å›å‚³å‹åˆ¥ data)</li>\n<li>Prisma Client å°±æ˜¯åœ¨ resolver è£¡ä½¿ç”¨çš„æ“ä½œè³‡æ–™ç®¡é“ï¼ˆå¿…é ˆåœ¨å‰é¢å®šç¾©å¥½ Schema ä¸‹ <code>npx prisma generate</code> æ‰æœƒæ›´æ–°å¾—ä»¥æ­£å¸¸ä½¿ç”¨ï¼‰<a href=\"https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-client/crud\" target=\"_blank\" rel=\"nofollow\">è©³ç´° CRUD èªªæ˜è«‹åƒé–± Prisma å®˜æ–¹æ–‡ä»¶</a></li>\n</ul>\n<h2>GraphQL Pagination Schema</h2>\n<blockquote>\n<p>Use Nodes when you have a finite list to use but donâ€™t need the cursors for pagination. Use Edges when you have large list and you need to know the cursors to paginate</p>\n</blockquote>\n<ul>\n<li><a href=\"https://medium.com/javascript-in-plain-english/graphql-pagination-using-edges-vs-nodes-in-connections-f2ddb8edffa0\" target=\"_blank\" rel=\"nofollow\">GraphQL Pagination best practices: Using Edges vs Nodes in Connections</a></li>\n<li><a href=\"https://relay.dev/graphql/connections.htm\" target=\"_blank\" rel=\"nofollow\">GraphQL Cursor Connections Specification</a></li>\n<li><a href=\"https://medium.com/@smallbee/super-fast-offset-pagination-with-prisma2-21db93e5cc90\" target=\"_blank\" rel=\"nofollow\">https://medium.com/@smallbee/super-fast-offset-pagination-with-prisma2-21db93e5cc90</a></li>\n</ul>\n<h2>Resources</h2>\n<ul>\n<li><a href=\"https://graphql.org/learn/\" target=\"_blank\" rel=\"nofollow\">GraphQL</a> ğŸ”†</li>\n<li><a href=\"https://ithelp.ithome.com.tw/users/20111997/ironman/1878\" target=\"_blank\" rel=\"nofollow\">2019 iT é‚¦å¹«å¿™éµäººè³½ - Think in GraphQL ç³»åˆ—</a></li>\n<li><a href=\"https://blog.logrocket.com/code-first-vs-schema-first-development-graphql/\" target=\"_blank\" rel=\"nofollow\">Code-first vs. schema-first development in GraphQL</a></li>\n<li><a href=\"https://github.com/Shopify/graphql-design-tutorial/blob/master/TUTORIAL.md\" target=\"_blank\" rel=\"nofollow\">Shopify Tutorial: Designing a GraphQL API</a></li>\n<li>\n<p><a href=\"https://ithelp.ithome.com.tw/articles/10207606\" target=\"_blank\" rel=\"nofollow\">N+1 Problem â†’ GraphQL Design: ä½¿ç”¨ DataLoader æå‡æ•ˆèƒ½ !</a></p>\n<blockquote>\n<p><a href=\"https://github.com/Tyler-ntut/singple_backend\" target=\"_blank\" rel=\"nofollow\">Github singple_backend</a></p>\n</blockquote>\n</li>\n</ul>\n<hr>\n<h2>Workshop</h2>\n<p>Clone â†’ <a href=\"https://gitlab.baifu-tech.net/f2e_tw/serverworkshop\" target=\"_blank\" rel=\"nofollow\">https://gitlab.baifu-tech.net/f2e_tw/serverworkshop</a></p>\n<ul>\n<li>Define prisma schema and create tables</li>\n<li>Define graphql schema, api entry point, and implement the resolvers</li>\n<li>Add <a href=\"https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-client/filtering\" target=\"_blank\" rel=\"nofollow\">Filter</a> input type</li>\n<li>Add Sort input type</li>\n<li>Self Relation examples (self-relations branch)</li>\n<li>Spilt TypeDefs &#x26; Resolvers (spilt-files-example)</li>\n</ul>","timeToRead":9,"frontmatter":{"title":"Apollo Server å…¥é–€ç¯‡","date":"10 Sep 2020","tags":["apollo"],"path":"blog/20200910","excerpt":"å¿«é€Ÿè¤‡ç¿’å»å¹´åˆ†äº«çš„ GraphQL Schema å’Œ Client query èªæ³•ï¼Œä¸¦ç°¡ä»‹å¦‚ä½•ä»¥ Apollo Server å»ºç«‹ GraphQL Serverã€‚"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"path":"blog/20210725","title":"åˆè©¦ SonarQube","tags":["tool"],"excerpt":"è¨˜éŒ„ä¸‹èªè­˜çš„æ–°æ±è¥¿ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20220206","title":"æ·ºå…¥æ·ºå‡º Service Worker","tags":["javascript"],"excerpt":"ç°¡å–®ç´€éŒ„ä¸‹é—œæ–¼ PWA èˆ‡ Service Worker çš„è§€é»èˆ‡ä¸»è¦åŠŸèƒ½ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20210725-2","title":"SVGR è¨­ç½®","tags":["javascript"],"excerpt":"webpack loader ä»¥ Component æ–¹å¼ä½¿ç”¨ Svgã€‚"}}},{"node":{"frontmatter":{"path":"blog/20210110","title":"Pop Quiz","tags":["javascript"],"excerpt":"è¨˜éŒ„è¸©åˆ°çš„é™·é˜±é¡Œã€‚"}}},{"node":{"frontmatter":{"path":"blog/20210109-3","title":"REST / RESTful & HTTP Methods","tags":["javascript"],"excerpt":"ç°¡æ˜“æ•´ç†ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20210109","title":"Response Set-Cookie ç„¡æ•ˆ","tags":["apollo"],"excerpt":"è¨˜éŒ„å€‹ä¹‹å‰åœ¨å’ŒåŒäº‹å€‘å¼„ Side project æ™‚çŠ¯è ¢é‡åˆ°çš„å•é¡Œèˆ‡è§£æ±ºæ–¹å¼ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20210109-2","title":"IntersectionObserver","tags":["javascript"],"excerpt":"å…¬å¸å°ˆæ¡ˆæœ‰å€‹æ—¥æœŸé€£å‹•çš„ scroll å„ªåŒ–è©¦é©—ï¼ŒåŸå…ˆæ˜¯ç›£è½ scrollã€‚"}}},{"node":{"frontmatter":{"path":"blog/20190909","title":"Prisma - Schema, Data Model, Relations, Client","tags":["prisma"],"excerpt":"æœªä¾† Side project å¯èƒ½æœƒæ‡‰ç”¨åˆ°çš„ SDL first é–‹ç™¼æµç¨‹è§’åº¦ï¼Œç°¡ä»‹æ­¤å¯ä»¥å–ä»£å‚³çµ± ORM çš„ DB toolkitã€‚"}}},{"node":{"frontmatter":{"path":"blog/20200630","title":"Express - Authentication, Authorization and Security","tags":["security","express"],"excerpt":"ç°¡ä»‹ Express RESTful API Server ç¯„ä¾‹ä¸­ JWT æ¬Šé™ã€æˆæ¬Šç›¸é—œã€‚"}}},{"node":{"frontmatter":{"path":"blog/20200518","title":"å¸¸ç”¨ NoSQL é›²ç«¯è³‡æ–™åº« - Part 1 MongoDB","tags":["mongodb"],"excerpt":"ç°¡ä»‹ Relational/NoSQL databaseã€mongoose ORM å¯« mongo CRUD APIã€‚"}}},{"node":{"frontmatter":{"path":"blog/20200527","title":"å¸¸ç”¨ NoSQL é›²ç«¯è³‡æ–™åº« - Part 2 Firebase","tags":["firebase"],"excerpt":"ç°¡ä»‹ Google æä¾›çš„å¾Œç«¯æœå‹™å¹³è‡ºï¼ˆBaaSï¼‰ä¸­çš„å…©ç¨® DBï¼Œrealtime database å’Œ cloud firestoreã€‚"}}},{"node":{"frontmatter":{"path":"blog/20191107","title":"Javascript Event loop - macro task & micro task","tags":["javascript"],"excerpt":"ä»‹ç´¹ Event loop å®¹æ˜“æ··æ·†çš„ç•°æ­¥ä»»å‹™ macro task & micro taskã€‚"}}},{"node":{"frontmatter":{"path":"blog/20191125","title":"åˆæ¢ RxJSï¼ˆä¸‹ï¼‰","tags":["rxjs"],"excerpt":"ç°¡ä»‹ä¸Šæ¬¡æœªå®Œçš„ RxJS å‰©é¤˜è§’è‰²ï¼Œå’Œä»‹ç´¹ç›®å‰å…¬å¸å¾Œå°å°ˆæ¡ˆä½¿ç”¨çš„ redux-observableã€‚"}}},{"node":{"frontmatter":{"path":"blog/20191017","title":"åˆæ¢ RxJSï¼ˆä¸Šï¼‰","tags":["rxjs"],"excerpt":"ç°¡ä»‹ç›¸é—œçš„è¨­è¨ˆæ¨¡å¼ä¸­çš„ Behavioral Patternï¼Œå†ä»‹ç´¹ RxJSï¼ˆå…ˆè¬› Observableï¼‰"}}},{"node":{"frontmatter":{"path":"blog/20190907","title":"GraphQL & Apollo Client","tags":["apollo"],"excerpt":"ç°¡å–®ä»‹ç´¹ React Client ç«¯å¦‚ä½•ç”¨ Apollo å° GraphQL Server åšè³‡æ–™å­˜å–æ“ä½œã€‚"}}},{"node":{"frontmatter":{"path":"blog/20190906","title":"åˆæ¢ Storybook","tags":["javascript"],"excerpt":"åˆæ¢é€™æ¬¾èƒ½å¤ åœ¨é–‹ç™¼å‰ç«¯å…ƒä»¶æˆ–æ˜¯å‡½å¼åº«çš„åŒæ™‚ï¼Œå¯ä»¥å¿«é€Ÿåœ°å»ºç«‹å…ƒä»¶å„ç¨®æ“ä½œæ¨¡å¼æˆ–æ˜¯æ¨£å¼çš„å·¥å…·ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20190906-2","title":"React Hooks - useCallback, useMemo, useRef","tags":["reactjs"],"excerpt":"JavaScript æ˜¯å–®åŸ·è¡Œç·’ã€å–®ç·šç¨‹çš„ç¨‹å¼èªè¨€ï¼Œæ‰€æœ‰çš„ç¨‹å¼ç¢¼ç‰‡æ®µéƒ½æœƒåœ¨å †ç–Šä¸­è¢«åŸ·è¡Œï¼ŒWeb worker ç›¸ç•¶æ–¼å¯è®“ä¸»ç·šç¨‹é–‹å…¶ä»– threadã€‚"}}},{"node":{"frontmatter":{"path":"blog/20190707","title":"JavaScript HTML5 Web Worker & CRA ä½¿ç”¨è¸©é›·","tags":["javascript"],"excerpt":"JavaScript æ˜¯å–®åŸ·è¡Œç·’ã€å–®ç·šç¨‹çš„ç¨‹å¼èªè¨€ï¼Œæ‰€æœ‰çš„ç¨‹å¼ç¢¼ç‰‡æ®µéƒ½æœƒåœ¨å †ç–Šä¸­è¢«åŸ·è¡Œï¼ŒWeb worker ç›¸ç•¶æ–¼å¯è®“ä¸»ç·šç¨‹é–‹å…¶ä»– threadã€‚"}}},{"node":{"frontmatter":{"path":"blog/20180521","title":"Web å¸¸è¦‹æ”»æ“Šæ‰‹æ³•","tags":["security"],"excerpt":"æ“æœ‰åŸºæœ¬çš„è³‡å®‰è§€å¿µä¿è­·å¥½è‡ªå®¶è³‡æ–™å’Œ user ä½¿ç”¨ç’°å¢ƒæ˜¯é–‹ç™¼äººå“¡é‡è¦çš„ä¸€é»ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20180514","title":"JavaScript ä¸­ this æŒ‡å‘","tags":["javascript"],"excerpt":"ç°¡ä»‹ this æŒ‡å‘çš„å…­ç¨®æƒ…æ³ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20190108","title":"JavaScript èªè­˜éåŒæ­¥ Callback, Promise, async/await","tags":["javascript"],"excerpt":"Asynchronous éåŒæ­¥çš„ä¸åŒå¯«æ³•çš„æ•´ç†ç­†è¨˜ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20170714","title":"WebForm ä½¿ç”¨ reCAPTCHA é©—è­‰","tags":["asp.net"],"excerpt":"é€™å€‹æˆ‘ä¸æ˜¯æ©Ÿå™¨äººé©—è­‰ä¸€å®šä¸é™Œç”Ÿï¼Œæ»¿å¤šç™»å…¥ç•«é¢æœƒçœ‹åˆ°çš„ï¼Œå‰›å¥½ä»Šå¤©æ¥åˆ°æŠŠåœ–å½¢é©—è­‰æ”¹ç‚º reCAPTCHA å°±é †æ‰‹è¨˜ä¸‹ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20170728","title":"WebForm è¨»å†Š JavaScript","tags":["asp.net","javascript"],"excerpt":"å‹•æ…‹ç”¢ç”ŸJSåœ¨ç›®å‰å…¬å¸å°ˆæ¡ˆä¸­æ˜¯æ»¿å¸¸ç”¨åˆ°çš„å°æŠ€å·§ï¼Œä¸åŒçš„ç”¨æ³•æœƒç”¢ç”Ÿåœ¨Web Page çš„ä¸åŒä½ç½®è€Œæœ‰ç›´è­¯å¼èªè¨€çš„å‰å¾Œé †åºå·®ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20170604","title":"Web App æ¨æ’­é€šçŸ¥","tags":["asp.net"],"excerpt":"éš¨è‘—è¡Œå‹•å’Œç©¿è¼‰è£ç½®çš„èˆˆèµ·ï¼Œæ¨æ’­é€šçŸ¥ (Push Notification) æˆç‚ºç¶­ç¹«Appç”¨æˆ¶é—œä¿‚ç›¸ç•¶æœ‰åŠ›çš„å·¥å…·"}}},{"node":{"frontmatter":{"path":"blog/20170508","title":"WebForm åœ–ç‰‡ä¸Šå‚³æª¢æŸ¥","tags":["asp.net"],"excerpt":"é–‹æ”¾ä¸Šå‚³æœ‰å¯èƒ½è¢«å‚³å¥‡æ€ªæ±è¥¿çš„é¢¨éšªï¼Œåªæª¢æŸ¥æ‰€çœ‹åˆ°çš„å‰¯æª”åï¼Œè¬¹æ…ä¾†èªªä¼¼ä¹æ˜¯ä¸å¤ çš„ã€‚"}}},{"node":{"frontmatter":{"path":"blog/20170421","title":"å­˜å–é ç«¯ EventLog","tags":["asp.net","javascript"],"excerpt":"åœ¨å…¬å¸ä¸­å¯¦ä½œä¸€å€‹ Event log çš„æŸ¥è©¢å·¥å…·ã€‚ï¼ˆä¹‹å¾Œä¾†å¯«äº† D3 å‘ˆç¾æŸ¥è©¢ç•°å¸¸æŸ¥è©¢çš„éƒ¨åˆ†ï¼‰"}}}]}},"pageContext":{"postPath":"blog/20200910","translations":[{"hreflang":"en","path":"/blog/20200910"}]}},"staticQueryHashes":["4097791827"]}